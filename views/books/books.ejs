<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/header', { title: 'Books - Book Tracker'}) %>
  <link rel="stylesheet" href="/styles/bookCard.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
  <style>
       /* Base & Layout */
    body, h1, h2, h3, p, a {
      font-family: 'Arial', sans-serif;
      color: #333;
    }
    
    body {
      background-color: #f4f4f4;
    }

    .jumbotron, .collapse-content, .all-books-section {
      background-color: #fff;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-top: 20px;
    }

    .container {
      width: 100%; /* Adjust as needed */
      max-width: 1200px; /* Or whatever maximum width you prefer */
      margin: 0 auto; /* Center the container */
    }
 
    .books-container, .all-books-container, .section-container, .bookrow, .book-section {
      display: flex;
      flex-wrap: wrap;
    }

    /* Navigation & Alphabet */
    .alphabet-navigation {
      position: fixed;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.05);
    }

    .alphabet-navigation a {
      display: block;
      font-size: 20px;
      color: #333;
      text-decoration: none;
      margin: 5px 0;
    }

    /* Interactive Elements */
    .fab, .collapse-header {
      transition: background-color 0.3s, color 0.3s, transform 0.2s;
    }

    .fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #007bff;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      font-size: 0; /* Hide the text */
      align-items: center;
      justify-content: center;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }

    .fab::before {
      content: "+";
      font-size: 55px;
      color: white;
    }

    /* Headers & Titles */
    .stats-title, .all-books-header {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stats-number {
      font-size: 18px;
      color: #17a2b8;
    }

    /* Stats & Cards */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* This will create as many columns as can fit */
      gap: 15px;
      background: #fff;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .stats-item {
      text-align: center;
      color: #505050;
      background-color: #fafafa;
    }

    .book-card {
      margin-right: 10px;
      margin-bottom: 10px;
    }

    /* Hover States */
    .fab:hover, .collapse-header:hover, .alphabet-navigation a:hover {
      background-color: #0056b3;
      color: white;
    }

    /* Media Queries */
    @media (max-width: 768px) {
      .books-container, .bookrow, .stats-container, .section-container {
        flex-direction: column;
      }
      .book-card, .collapse-header {
        width: 100%;
        margin-right: 0;
      }
    }
  </style>
</head>
<body>
  <%- include('../partials/bookcardModal') %>
  <%- include('../navbar') %>

  <div class="container mt-4">

      <div class="container mt-4">
        <div class="stats-container">
          <div class="stats-item">
            <div class="stats-title">Total Books</div>
            <div class="stats-number"><%= stats.totalBooks %></div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Books Read</div>
            <div class="stats-number"><%= stats.readBooks %></div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Total Series</div>
            <div class="stats-number"><%= stats.totalSeries %></div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Popular Author</div>
            <div class="stats-number"><%= stats.popularAuthor ? stats.popularAuthor.name : 'N/A' %></div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Popular Narrator</div>
            <div class="stats-number"><%= stats.popularNarrator ? stats.popularNarrator.name : 'N/A' %></div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Last Read</div>
            <div class="stats-number"><%= stats.latestReadBook ? stats.latestReadBook.title : 'N/A' %></div>
          </div>
          <div class="stats-item">
            <div class="stats-title">Most Read Author</div>
            <div class="stats-number"><%= stats.mostReadAuthor ? stats.mostReadAuthor : 'N/A' %> (<%= stats.mostReadAuthorCount %>)</div>
          </div>

    </div>
 <!-- Alphabet Navigation -->
 <div class="alphabet-navigation">
  <% for(let i = 65; i <= 90; i++) { %>
    <a href="#<%= String.fromCharCode(i) %>"><%= String.fromCharCode(i) %></a>
  <% } %>
</div>
    </div></div>
<!-- Books Sections -->
<div class="all-books-section">

<div class="book-filter">
  <div class="row">
    <div class="col">
      <form id="filterForm" action="/books" method="get">
        <label for="statusFilter">Filter by status:</label>
        <select id="statusFilter" name="status" onchange="document.getElementById('filterForm').submit();">
          <option value="">All</option>
          <% statuses.forEach(function(status) { %>
            <option value="<%= status.id %>" <%= (status.id.toString() === statusFilter) ? 'selected' : '' %>><%= status.name %></option>
          <% }); %>
        </select>
        
        <!-- Preserve the search query when filtering -->
        <% if(searchQuery) { %>
          <input type="hidden" name="search" value="<%= searchQuery %>">
        <% } %>
      </form>
    </div>
</div></dir>
<div class="books-container" >
  <% for(let i = 65; i <= 90; i++) { %>
    <% let filteredBooks = books.filter(book => book.title[0].toUpperCase() === String.fromCharCode(i)); %>
    <% if (filteredBooks.length > 0) { %>
      <div id="<%= String.fromCharCode(i) %>" class="book-section-anchor"></div>
    <% } %>
    <% filteredBooks.forEach(function(book) { %>
      <div class="bookrow">
        <%- include('../partials/bookCard', { book: book }) %>
      </div>
    <% }) %>
  <% } %>
</div>

  <%- include('../partials/footer') %>
  

  <script>
    const updateCollapseHeaders = () => {
      const nextUpHeader = document.querySelector('.next-up-header');
      const nextUpSection = document.getElementById('nextUpSection');


      nextUpHeader.classList.toggle('inactive-header', !nextUpSection.classList.contains('show'));

    };

    const clearSearchResults = () => {
      const searchResultsSection = document.getElementById('searchResultsSection');
      if (!searchResultsSection.classList.contains('show')) {
        window.location.href = '/books';
      }
    };

    if (document.querySelector('.search-results-header')) {
      document.querySelector('.search-results-header').addEventListener('click', () => {
        setTimeout(clearSearchResults, 350);
      });
    }

    // Toggle the "Next Up" section on header click
    document.querySelector('.next-up-header').addEventListener('click', function() {
      var nextUpSection = document.getElementById('nextUpSection');
      nextUpSection.classList.toggle('show');
    });

    // Initial state update
    updateCollapseHeaders();

      function filterBooksByStatus() {
        const statusId = document.getElementById('statusFilter').value;
        window.location.href = `/books/filter?status=${statusId}`; // This should match your existing route for filtering
      }

    
  </script>
  <a href="/books/add" class="fab" id="addBookButton">+</a>

</body>
</html>
