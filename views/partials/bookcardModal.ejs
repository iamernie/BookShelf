<script>
    function showBookDetails(element) {
      var bookData = element.getAttribute("data-book");
      var book = JSON.parse(bookData);

      var modalBody = document.querySelector("#bookDetailsModal .modal-body");
      var modalFooter = document.querySelector(
        "#bookDetailsModal .modal-footer"
      );

      modalBody.innerHTML = `
        <img src="${
          book.coverImageUrl
        }" alt="Book Cover" class="img-fluid mb-3">
        <p><strong>Title:</strong> ${book.title}</p>
        <p><strong>Author:</strong> ${
          book.Author ? book.Author.name : "Unknown"
        }</p>
        <!-- Include other book properties here -->
      `;

      modalFooter.innerHTML = `
        <a href="/books/edit/${book.id}" class="btn btn-primary">Edit</a>
        <form action="/books/${book.id}?_method=DELETE" method="post" style="display: inline">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      `;
    }
    let statusMap = {};

    function fetchStatusMappings() {
        fetch('/books/status-mappings')
            .then(response => response.json())
            .then(data => {
                statusMap = data;
            })
            .catch(error => console.error('Error fetching status mappings:', error));
    }
    
    function changeStatus(bookId, newStatusName) {
      const newStatusId = statusMap[newStatusName];
      if (newStatusId) {
          fetch(`/books/update-status/${bookId}`, {
              method: 'PUT',
              headers: {
                  'Content-Type': 'application/json',
              },
              body: JSON.stringify({ statusId: newStatusId }),
          })
          .then(response => {
              if (response.ok) {
                  // Reload the page or update the UI to reflect the status change
                  location.reload(); // Simplest way to reflect changes
              } else {
                  console.error('Failed to update status. Server responded with:', response.status);
              }
          })
          .catch(error => console.error('Error updating status:', error));
      } else {
          console.error('Status ID not found for:', newStatusName);
      }
  }
    
    // Call fetchStatusMappings when the page loads
    document.addEventListener('DOMContentLoaded', fetchStatusMappings);  

  </script>
    
    <!-- Modal Structure -->
    <div
      class="modal fade"
      id="bookDetailsModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="bookDetailsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="bookDetailsModalLabel">Book Details</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Book details will be dynamically inserted here -->
          </div>
          <div class="modal-footer">
            <!-- Edit and Delete buttons will be dynamically inserted here -->
          </div>
        </div>
      </div>
    </div>
    <!--  End of Modal content -->